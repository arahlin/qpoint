<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>qpoint.qpoint_class &#8212; qpoint 1.12.4.post1.dev18+g486712d documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinxdoc.css?v=87629129" />
    <script src="../../_static/documentation_options.js?v=2bcdd0eb"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">qpoint 1.12.4.post1.dev18+g486712d documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../qpoint.html" accesskey="U">qpoint</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">qpoint.qpoint_class</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for qpoint.qpoint_class</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_libqpoint</span> <span class="k">as</span> <span class="n">lib</span>
<span class="kn">from</span> <span class="nn">._libqpoint</span> <span class="kn">import</span> <span class="n">libqp</span> <span class="k">as</span> <span class="n">qp</span>
<span class="kn">from</span> <span class="nn">._libqpoint</span> <span class="kn">import</span> <span class="n">check_input</span><span class="p">,</span> <span class="n">check_inputs</span><span class="p">,</span> <span class="n">check_output</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;QPoint&quot;</span><span class="p">,</span> <span class="s2">&quot;check_input&quot;</span><span class="p">,</span> <span class="s2">&quot;check_inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;check_output&quot;</span><span class="p">]</span>


<div class="viewcode-block" id="QPoint">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint">[docs]</a>
<span class="k">class</span> <span class="nc">QPoint</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<div class="viewcode-block" id="QPoint.__init__">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_iers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a `QPoint` memory instance for keeping track of pointing</span>
<span class="sd">        corrections over time.</span>

<span class="sd">        If `update_iers` is `True`, attempt to call the method</span>
<span class="sd">        :meth:`update_bulletin_a` to update the internal IERS-A database</span>
<span class="sd">        (requires `astropy` version 1.2 or newer).</span>

<span class="sd">        Any remaining keyword arguments are passed to :meth:`set` to update</span>
<span class="sd">        memory.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># initialize memory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span> <span class="o">=</span> <span class="n">qp</span><span class="o">.</span><span class="n">qp_init_memory</span><span class="p">()</span>

        <span class="c1"># try to update IERS-A bulletin</span>
        <span class="k">if</span> <span class="n">update_iers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_bulletin_a</span><span class="p">()</span>

        <span class="c1"># collect all parameter functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_funcs</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">qp_funcs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_funcs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_all_funcs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_funcs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

        <span class="c1"># set any requested parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="QPoint.print_memory">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.print_memory">[docs]</a>
    <span class="k">def</span> <span class="nf">print_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print current memory state in C.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qp</span><span class="o">.</span><span class="n">qp_print_memory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Free memory before deleting the object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qp</span><span class="o">.</span><span class="n">qp_free_memory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a single parameter to the given value.  See :meth:`set` for a list</span>
<span class="sd">        of parameter names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_funcs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Unknown parameter </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_funcs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;check_set&quot;</span><span class="p">](</span><span class="n">val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_all_funcs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;set&quot;</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the value for a single parameter.  See :meth:`set` for a list of</span>
<span class="sd">        parameter names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_funcs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Unknown parameter </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_funcs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;get&quot;</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_funcs</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;check_get&quot;</span><span class="p">](</span><span class="n">val</span><span class="p">)</span>

<div class="viewcode-block" id="QPoint.set">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.set">[docs]</a>
    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set computation options.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        rate_daber : {&#39;never&#39;, &#39;once&#39;, &#39;always&#39;}, or float</span>
<span class="sd">            Rate at which the diurnal aberration correction is applied in seconds</span>
<span class="sd">            (NB: this can only be applied always or never)</span>
<span class="sd">        rate_lonlat : {&#39;never&#39;, &#39;once&#39;, &#39;always&#39;}, or float</span>
<span class="sd">            Rate at which observer&#39;s lon and lat are updated</span>
<span class="sd">        rate_wobble : {&#39;never&#39;, &#39;once&#39;, &#39;always&#39;}, or float</span>
<span class="sd">            Rate at which the polar motion correction is updated</span>
<span class="sd">            (NB: these are not estimated for dates beyond a year from now)</span>
<span class="sd">        rate_dut1 : {&#39;never&#39;, &#39;once&#39;, &#39;always&#39;}, or float</span>
<span class="sd">            Rate at which the ut1-utc correction is updated</span>
<span class="sd">            (NB: this is not estimated for dates beyond a year from now)</span>
<span class="sd">        rate_erot : {&#39;never&#39;, &#39;once&#39;, &#39;always&#39;}, or float</span>
<span class="sd">            Rate at which the earth&#39;s rotation angle is updated</span>
<span class="sd">        rate_npb : {&#39;never&#39;, &#39;once&#39;, &#39;always&#39;}, or float</span>
<span class="sd">            Rate at which the nutation/precession/frame-bias terms are updated</span>
<span class="sd">        rate_aaber : {&#39;never&#39;, &#39;once&#39;, &#39;always&#39;}, or float</span>
<span class="sd">            Rate at which the annual aberration correction</span>
<span class="sd">            (due to the earth&#39;s orbital velocity) is updated</span>
<span class="sd">        rate_ref : {&#39;never&#39;, &#39;once&#39;, &#39;always&#39;}, or float</span>
<span class="sd">            Rate at which the refaction correction is updated (NB: this</span>
<span class="sd">            correction can also be updated manually -- see :meth:`refraction`)</span>
<span class="sd">        accuracy : &#39;low&#39; or &#39;high&#39;</span>
<span class="sd">            If &#39;low&#39;, use a truncated form (2000b) for the NPB correction,</span>
<span class="sd">            which is much faster but less accurate. If &#39;high&#39; (default), use</span>
<span class="sd">            the full 2006/2000a form.</span>
<span class="sd">        mean_aber : bool</span>
<span class="sd">            If True, apply the aberration correction as an average for the</span>
<span class="sd">            entire field of view.  This is gives a 1-2 arcsec deviation</span>
<span class="sd">            at the edges of the SPIDER field of view.</span>
<span class="sd">        fast_aber : bool</span>
<span class="sd">            If True, apply the aberration correction using the exact</span>
<span class="sd">            angle and quaternion rotation.  Otherwise, use a small-angle</span>
<span class="sd">            approximation for the aberration quaternion (default).</span>
<span class="sd">        fast_math : bool</span>
<span class="sd">            If True, use polynomial approximations for trig functions</span>
<span class="sd">        polconv : &#39;cosmo&#39; or &#39;iau&#39;</span>
<span class="sd">            Specify the &#39;cosmo&#39; or &#39;iau&#39; polarization convention</span>
<span class="sd">        pix_order : &#39;nest&#39; or &#39;ring&#39;</span>
<span class="sd">            HEALPix pixel ordering</span>
<span class="sd">        interp_pix : bool</span>
<span class="sd">            If True, interpolate between pixels in scanning the source map.</span>
<span class="sd">        fast_pix : bool</span>
<span class="sd">            If True, use `vec2pix` to get pixel number directly from the</span>
<span class="sd">            quaternion instead of `ang2pix` from ra/dec.</span>
<span class="sd">        error_missing : bool</span>
<span class="sd">            If True, raise an error if reading/writing missing pixels.</span>
<span class="sd">        nan_missing : bool</span>
<span class="sd">            If True, fill samples from missing pixels with NaN.</span>
<span class="sd">            Only used if `error_missing` is False.</span>
<span class="sd">        interp_missing : bool</span>
<span class="sd">            If True and `interp_pix` is True, drop missing neighbors</span>
<span class="sd">            and reweight remaining neighbors.  Overrides `nan_missing`.</span>
<span class="sd">        num_threads : bool</span>
<span class="sd">             Number of openMP threads to use for mapmaking.</span>
<span class="sd">        temperature : float</span>
<span class="sd">            Ambient temperature, Celcius. For computing refraction corrections.</span>
<span class="sd">        pressure : float</span>
<span class="sd">            Ambient pressure, mbar. For computing refraction corrections.</span>
<span class="sd">        humidity : float</span>
<span class="sd">            Relative humidity, fraction. For computing refraction corrections.</span>
<span class="sd">        frequency : float</span>
<span class="sd">            Observer frequency, GHz. For computing refraction corrections.</span>
<span class="sd">        dut1 : float</span>
<span class="sd">            UT1 correction</span>
<span class="sd">        ref_delta : float</span>
<span class="sd">            Refraction correction</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">continue</span></div>


<div class="viewcode-block" id="QPoint.get">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.get">[docs]</a>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dictionary of the requested state parameters.  If no</span>
<span class="sd">        parameters are supplied, then all are returned.  If a single parameter</span>
<span class="sd">        is supplied, then just that value is returned.  See :meth:`set` for a</span>
<span class="sd">        list of parameter names.</span>

<span class="sd">        Can also select &#39;options&#39;, &#39;rates&#39;, &#39;weather&#39;, or &#39;params&#39; to return</span>
<span class="sd">        all of that subset of parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcs</span><span class="p">:</span>
                <span class="n">state</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcs</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">state</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">kk</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">state</span>

        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcs</span><span class="p">:</span>
                <span class="n">state</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcs</span><span class="p">[</span><span class="n">arg</span><span class="p">]:</span>
                    <span class="n">state</span><span class="p">[</span><span class="n">arg</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">state</span><span class="p">[</span><span class="n">arg</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">state</span><span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">state</span></div>


<div class="viewcode-block" id="QPoint.reset_rates">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.reset_rates">[docs]</a>
    <span class="k">def</span> <span class="nf">reset_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset update counters for each state.  Useful to force an updated</span>
<span class="sd">        correction term at the beginning of each chunk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qp</span><span class="o">.</span><span class="n">qp_reset_rates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">)</span></div>


<div class="viewcode-block" id="QPoint.reset_inv_rates">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.reset_inv_rates">[docs]</a>
    <span class="k">def</span> <span class="nf">reset_inv_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset update counters for each inverse state.  Useful to force an updated</span>
<span class="sd">        correction term at the beginning of each chunk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qp</span><span class="o">.</span><span class="n">qp_reset_inv_rates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">)</span></div>


<div class="viewcode-block" id="QPoint.refraction">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.refraction">[docs]</a>
    <span class="k">def</span> <span class="nf">refraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;refraction(q, **kwargs)</span>
<span class="sd">        refraction(delta)</span>

<span class="sd">        Update refraction parameters</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        q : quaternion or array of quaternions</span>
<span class="sd">            Observer orientation in horizon coordinates</span>
<span class="sd">        temperature : float</span>
<span class="sd">            Ambient temperature, Celcius</span>
<span class="sd">        pressure : float</span>
<span class="sd">            Ambient pressure, mbar</span>
<span class="sd">        humidity : float</span>
<span class="sd">            Ambient relative humidity, fraction</span>
<span class="sd">        frequency : float</span>
<span class="sd">            Observing frequency, GHz</span>
<span class="sd">        delta : float</span>
<span class="sd">            The refraction correction itself, in degrees</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        delta : array_like</span>
<span class="sd">            Refraction correction computed at each input orientation</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If `q` is given, then the refraction correction in degrees</span>
<span class="sd">        is calculated, stored and returned after updating any other given</span>
<span class="sd">        parameters. Otherwise, the correction is returned w/out recalculating.</span>

<span class="sd">        Alternatively, if a single numerical argument, or the `delta` keyword</span>
<span class="sd">        argument is given, then the correction is stored with this value</span>
<span class="sd">        instead of being recalculated.</span>

<span class="sd">        Numpy-vectorized for the `q` argument.  Note that this is not</span>
<span class="sd">        an efficient vectorization, and only the last calculated value is</span>
<span class="sd">        stored for use in the coordinate conversion functions.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="s2">&quot;ref_delta&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">v</span>

        <span class="k">if</span> <span class="s2">&quot;delta&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;delta&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="s2">&quot;ref_delta&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">v</span>

        <span class="n">arg_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;q&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_funcs</span><span class="p">[</span><span class="s2">&quot;weather&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="n">arg_names</span><span class="p">[</span><span class="n">idx</span><span class="p">]]</span> <span class="o">=</span> <span class="n">a</span>

        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_funcs</span><span class="p">[</span><span class="s2">&quot;weather&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>

        <span class="n">q</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">q</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">):</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x3</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">qp</span><span class="o">.</span><span class="n">qp_update_ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

            <span class="n">fvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">q</span><span class="o">.</span><span class="n">size</span> <span class="o">//</span> <span class="mi">4</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">fvec</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">delta</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
                <span class="k">return</span> <span class="n">delta</span><span class="p">[()]</span>
            <span class="k">return</span> <span class="n">delta</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s2">&quot;ref_delta&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="QPoint.gmst">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.gmst">[docs]</a>
    <span class="k">def</span> <span class="nf">gmst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return Greenwich mean sidereal time for given ctimes.</span>
<span class="sd">        Vectorized.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        ctime : array_like</span>
<span class="sd">            Unix time in seconds UTC</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        gmst : array_like</span>
<span class="sd">            Greenwich mean sidereal time of the observer</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">ctime</span> <span class="o">=</span> <span class="n">check_input</span><span class="p">(</span><span class="s2">&quot;ctime&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">ctime</span><span class="p">))</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">ctime</span><span class="o">.</span><span class="n">size</span>

        <span class="n">gmst</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;gmst&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">ctime</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">qp</span><span class="o">.</span><span class="n">qp_gmstn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">gmst</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">gmst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">gmst</span></div>


<div class="viewcode-block" id="QPoint.lmst">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.lmst">[docs]</a>
    <span class="k">def</span> <span class="nf">lmst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return local mean sidereal time for given ctimes and longitudes.</span>
<span class="sd">        Vectorized, input arguments must be broadcastable to the same shape.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        ctime : array_like</span>
<span class="sd">            Unix time in seconds UTC</span>
<span class="sd">        lon : array_like</span>
<span class="sd">            Observer longitude (degrees)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        lmst : array_like</span>
<span class="sd">            Local mean sidereal time of the observer</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">ctime</span><span class="p">,</span> <span class="n">lon</span> <span class="o">=</span> <span class="n">check_inputs</span><span class="p">(</span><span class="n">ctime</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">ctime</span><span class="o">.</span><span class="n">size</span>

        <span class="n">lmst</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;lmst&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">ctime</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">qp</span><span class="o">.</span><span class="n">qp_lmstn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lmst</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">lmst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">lmst</span></div>


<div class="viewcode-block" id="QPoint.dipole">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.dipole">[docs]</a>
    <span class="k">def</span> <span class="nf">dipole</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return dipole amplitude in the given equatorial direction.</span>
<span class="sd">        Vectorized, input arguments must be broadcastable to the same shape.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        ctime : array_like</span>
<span class="sd">            Unix time in seconds UTC</span>
<span class="sd">        ra : array_like</span>
<span class="sd">            Right ascension on the sky, in degrees.</span>
<span class="sd">        dec : array_like</span>
<span class="sd">            Declination on the sky, in degrees</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dipole : array_like</span>
<span class="sd">            Dipole amplitude in K</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">ctime</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">check_inputs</span><span class="p">(</span><span class="n">ctime</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">ctime</span><span class="o">.</span><span class="n">size</span>

        <span class="n">dipole</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;dipole&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">ctime</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">qp</span><span class="o">.</span><span class="n">qp_dipolen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">dipole</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dipole</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dipole</span></div>


<div class="viewcode-block" id="QPoint.bore2dipole">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.bore2dipole">[docs]</a>
    <span class="k">def</span> <span class="nf">bore2dipole</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q_off</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">q_bore</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate dipole timestream for given offset and boresight pointing.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        q_off : quaternion</span>
<span class="sd">            Detector offset quaternion for a single detector, calculated using</span>
<span class="sd">            :meth:`det_offset`</span>
<span class="sd">        ctime : array_like</span>
<span class="sd">            Array of unix times in seconds UTC</span>
<span class="sd">        q_bore : quaternion or array of quaternions</span>
<span class="sd">            Array of quaternions encoding the boresight orientation on the sky</span>
<span class="sd">            (as output by :meth:`azel2radec` or similar).  Broadcastable to the</span>
<span class="sd">            same length as `ctime`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dipole : array_like</span>
<span class="sd">            Dipole amplitude in K</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">q_off</span> <span class="o">=</span> <span class="n">check_input</span><span class="p">(</span><span class="s2">&quot;q_off&quot;</span><span class="p">,</span> <span class="n">q_off</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,),</span> <span class="n">quat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ctime</span> <span class="o">=</span> <span class="n">check_input</span><span class="p">(</span><span class="s2">&quot;ctime&quot;</span><span class="p">,</span> <span class="n">ctime</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">ctime</span><span class="o">.</span><span class="n">size</span>
        <span class="n">q_bore</span> <span class="o">=</span> <span class="n">check_input</span><span class="p">(</span><span class="s2">&quot;q_bore&quot;</span><span class="p">,</span> <span class="n">q_bore</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">quat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">dipole</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;dipole&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">ctime</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">qp</span><span class="o">.</span><span class="n">qp_bore2dipole</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">q_off</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">q_bore</span><span class="p">,</span> <span class="n">dipole</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dipole</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dipole</span></div>


<div class="viewcode-block" id="QPoint.det_offset">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.det_offset">[docs]</a>
    <span class="k">def</span> <span class="nf">det_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delta_az</span><span class="p">,</span> <span class="n">delta_el</span><span class="p">,</span> <span class="n">delta_psi</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return quaternion corresponding to the requested detector centroid</span>
<span class="sd">        offset from boresight.  Vectorized, input arguments must be</span>
<span class="sd">        broadcastable to the same shape.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        delta_az : array_like</span>
<span class="sd">            Azimuthal centroid offset of the detector in degrees</span>
<span class="sd">        delta_el : array_like</span>
<span class="sd">            Elevation centroid offset of the detector in degrees</span>
<span class="sd">        delta_psi : array_like</span>
<span class="sd">            Polarization offset of the detector from vertical in degrees</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        q : array_like</span>
<span class="sd">            Detector centroid offset quaternion for each detector</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">delta_az</span><span class="p">,</span> <span class="n">delta_el</span><span class="p">,</span> <span class="n">delta_psi</span> <span class="o">=</span> <span class="n">check_inputs</span><span class="p">(</span><span class="n">delta_az</span><span class="p">,</span> <span class="n">delta_el</span><span class="p">,</span> <span class="n">delta_psi</span><span class="p">)</span>
        <span class="n">ndet</span> <span class="o">=</span> <span class="n">delta_az</span><span class="o">.</span><span class="n">size</span>

        <span class="n">quat</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;quat&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">ndet</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">qp</span><span class="o">.</span><span class="n">qp_det_offsetn</span><span class="p">(</span><span class="n">delta_az</span><span class="p">,</span> <span class="n">delta_el</span><span class="p">,</span> <span class="n">delta_psi</span><span class="p">,</span> <span class="n">quat</span><span class="p">,</span> <span class="n">ndet</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ndet</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">quat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">quat</span></div>


<div class="viewcode-block" id="QPoint.bore_offset">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.bore_offset">[docs]</a>
    <span class="k">def</span> <span class="nf">bore_offset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">q_bore</span><span class="p">,</span> <span class="n">ang1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ang2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ang3</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">post</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply a fixed or variable offset to the boresight quaternion.</span>
<span class="sd">        Input arguments must be broadcastable to the same shape.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        q_bore : array_like</span>
<span class="sd">            boresight pointing quaternion</span>
<span class="sd">        ang1 : array_like, optional</span>
<span class="sd">            Azimuthal or ra offset in degrees</span>
<span class="sd">        ang2 : array_like, optional</span>
<span class="sd">            Elevation or dec offset in degrees</span>
<span class="sd">        ang3 : array_like, optional</span>
<span class="sd">            Position angle offset in degrees</span>
<span class="sd">        post : bool, optional</span>
<span class="sd">            If False, apply offset as an az/el/pa pre-rotation</span>
<span class="sd">            If True, apply offset as an ra/dec/pa post-rotation</span>
<span class="sd">        inplace : bool, optional</span>
<span class="sd">            If True, apply the rotation in-place in memory.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        q_bore : array_like</span>
<span class="sd">            Offset boresight quaternion</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">q_bore</span> <span class="o">=</span> <span class="n">check_input</span><span class="p">(</span>
            <span class="s2">&quot;q_bore&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">q_bore</span><span class="p">),</span> <span class="n">quat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="n">inplace</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">q_bore</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ang1</span><span class="p">,</span> <span class="n">ang2</span><span class="p">,</span> <span class="n">ang3</span><span class="p">]]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;One of ang1, ang2, ang3 is required&quot;</span><span class="p">)</span>
        <span class="n">ang1</span><span class="p">,</span> <span class="n">ang2</span><span class="p">,</span> <span class="n">ang3</span> <span class="o">=</span> <span class="n">check_inputs</span><span class="p">(</span><span class="n">ang1</span><span class="p">,</span> <span class="n">ang2</span><span class="p">,</span> <span class="n">ang3</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,))</span>
        <span class="n">qp</span><span class="o">.</span><span class="n">qp_bore_offset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">q_bore</span><span class="p">,</span> <span class="n">ang1</span><span class="p">,</span> <span class="n">ang2</span><span class="p">,</span> <span class="n">ang3</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">post</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">q_bore</span></div>


<div class="viewcode-block" id="QPoint.hwp_quat">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.hwp_quat">[docs]</a>
    <span class="k">def</span> <span class="nf">hwp_quat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return quaternion corresponding to rotation by 2 * theta, where theta is</span>
<span class="sd">        the physical waveplate angle. Vectorized.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        theta : array_like</span>
<span class="sd">            HWP physical angle in degrees</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        q : array_like</span>
<span class="sd">            Quaternion for each hwp angle</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">check_input</span><span class="p">(</span><span class="s2">&quot;theta&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">size</span>

        <span class="n">quat</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;quat&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">qp</span><span class="o">.</span><span class="n">qp_hwp_quatn</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">quat</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">quat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">quat</span></div>


<div class="viewcode-block" id="QPoint.azel2bore">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.azel2bore">[docs]</a>
    <span class="k">def</span> <span class="nf">azel2bore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate the quaternion for the boresight orientation on the sky given</span>
<span class="sd">        the attitude (az/el/pitch/roll), location on the earth (lon/lat) and</span>
<span class="sd">        ctime. Input vectors must be numpy-array-like and broadcastable to the</span>
<span class="sd">        same shape.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        az : array_like</span>
<span class="sd">            Boresight azimuth in degrees</span>
<span class="sd">        el : array_like</span>
<span class="sd">            Boresight elevation in degrees</span>
<span class="sd">        pitch : array_like</span>
<span class="sd">            Boresight pitch in degrees.  If `None`, this term is ignored.</span>
<span class="sd">        roll : array_like</span>
<span class="sd">            Boresight roll in degrees.  If `None`, this term is ignored.</span>
<span class="sd">        lon : array_like</span>
<span class="sd">            Observer longitude in degrees</span>
<span class="sd">        lat : array_like</span>
<span class="sd">            Observer latitude in degrees</span>
<span class="sd">        ctime : array_like</span>
<span class="sd">            Unix time in seconds UTC</span>
<span class="sd">        q : array_like, optional</span>
<span class="sd">            Output quaternion array initialized by user.  Supply this</span>
<span class="sd">            for in-place computation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        q : array_like</span>
<span class="sd">            Nx4 numpy array of quaternions for each supplied timestamp.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ctime</span> <span class="o">=</span> <span class="n">check_inputs</span><span class="p">(</span>
            <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ctime</span>
        <span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">size</span>

        <span class="c1"># identity quaternion</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="n">qp</span><span class="o">.</span><span class="n">qp_azel2bore</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">q</span></div>


<div class="viewcode-block" id="QPoint.azelpsi2bore">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.azelpsi2bore">[docs]</a>
    <span class="k">def</span> <span class="nf">azelpsi2bore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate the quaternion for the boresight orientation on the sky given</span>
<span class="sd">        the attitude (az/el/psi/pitch/roll), location on the earth (lon/lat) and</span>
<span class="sd">        ctime. Input vectors must be numpy-array-like and broadcastable to the</span>
<span class="sd">        same shape.</span>

<span class="sd">        This is an augmented version of azel2bore to accept rotations of the focal</span>
<span class="sd">        plane about the optical axis.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        az : array_like</span>
<span class="sd">            Boresight azimuth in degrees</span>
<span class="sd">        el : array_like</span>
<span class="sd">            Boresight elevation in degrees</span>
<span class="sd">        psi : array_like</span>
<span class="sd">            Boresight rotation angle in degrees</span>
<span class="sd">        pitch : array_like</span>
<span class="sd">            Boresight pitch in degrees.  If `None`, this term is ignored.</span>
<span class="sd">        roll : array_like</span>
<span class="sd">            Boresight roll in degrees.  If `None`, this term is ignored.</span>
<span class="sd">        lon : array_like</span>
<span class="sd">            Observer longitude in degrees</span>
<span class="sd">        lat : array_like</span>
<span class="sd">            Observer latitude in degrees</span>
<span class="sd">        ctime : array_like</span>
<span class="sd">            Unix time in seconds UTC</span>
<span class="sd">        q : array_like, optional</span>
<span class="sd">            Output quaternion array initialized by user.  Supply this</span>
<span class="sd">            for in-place computation.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        q : array_like</span>
<span class="sd">            Nx4 numpy array of quaternions for each supplied timestamp.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ctime</span> <span class="o">=</span> <span class="n">check_inputs</span><span class="p">(</span>
            <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ctime</span>
        <span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">size</span>

        <span class="c1"># identity quaternion</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="n">qp</span><span class="o">.</span><span class="n">qp_azelpsi2bore</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">n</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">q</span></div>


<div class="viewcode-block" id="QPoint.bore2radec">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.bore2radec">[docs]</a>
    <span class="k">def</span> <span class="nf">bore2radec</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">q_off</span><span class="p">,</span>
        <span class="n">ctime</span><span class="p">,</span>
        <span class="n">q_bore</span><span class="p">,</span>
        <span class="n">q_hwp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sindec</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">return_pa</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ra</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sin2psi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cos2psi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the orientation on the sky for a detector offset from the</span>
<span class="sd">        boresight.  Detector offsets are defined assuming the boresight is</span>
<span class="sd">        pointed toward the horizon, and that the boresight polarization axis is</span>
<span class="sd">        along the vertical.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        q_off : quaternion</span>
<span class="sd">            Detector offset quaternion for a single detector, calculated using</span>
<span class="sd">            :meth:`det_offset`.</span>
<span class="sd">        ctime : array_like</span>
<span class="sd">            Unix time in seconds UTC, broadcastable to shape (N,),</span>
<span class="sd">            the long dimension of `q_bore`.</span>
<span class="sd">        q_bore : quaternion or array of quaternions</span>
<span class="sd">            Nx4 array of quaternions encoding the boresight orientation on the</span>
<span class="sd">            sky (as output by :meth:`azel2radec` or equivalent)</span>
<span class="sd">        q_hwp : quaternion or array of quaternions, optional</span>
<span class="sd">            HWP angle quaternions calculated using :meth:`hwp_quat`.  Must be</span>
<span class="sd">            broadcastable to the same shape as `q_bore`.</span>
<span class="sd">        sindec : bool, optional</span>
<span class="sd">            If `True`, return sin(dec) instead of dec in degrees</span>
<span class="sd">            (default False).</span>
<span class="sd">        return_pa : bool, optional</span>
<span class="sd">            If `True`, return pa instead of sin2psi / cos2psi</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ra : array_like</span>
<span class="sd">            Detector right ascension in degrees</span>
<span class="sd">        dec/sindec : array_like</span>
<span class="sd">            Detector declination in degrees or sin(dec) if `sindec` is `True`.</span>
<span class="sd">        pa/sin2psi : array_like</span>
<span class="sd">            Detector polarization orientation if `return_pa` is `True`, or</span>
<span class="sd">            sin(2*pa) if `return_pa` is `False`.</span>
<span class="sd">        cos2psi : array_like</span>
<span class="sd">            detector polarization orientation cos(2*pa), if `return_pa` is `False`.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>

<span class="sd">        Pre-allocated output arguments can also be supplied as input keywords</span>
<span class="sd">        for in-place operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">q_off</span> <span class="o">=</span> <span class="n">check_input</span><span class="p">(</span><span class="s2">&quot;q_off&quot;</span><span class="p">,</span> <span class="n">q_off</span><span class="p">,</span> <span class="n">quat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">q_bore</span> <span class="o">=</span> <span class="n">check_input</span><span class="p">(</span><span class="s2">&quot;q_bore&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">q_bore</span><span class="p">),</span> <span class="n">quat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">q_bore</span><span class="o">.</span><span class="n">size</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,)</span>
        <span class="k">if</span> <span class="n">ctime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mean_aber&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ctime required if mean_aber is False&quot;</span><span class="p">)</span>
            <span class="n">ctime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">q_bore</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">ctime</span> <span class="o">=</span> <span class="n">check_input</span><span class="p">(</span><span class="s2">&quot;ctime&quot;</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">pars</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">ctime</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="n">ra</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="o">**</span><span class="n">pars</span><span class="p">)</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="o">**</span><span class="n">pars</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_pa</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sindec</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot use sindec with return_pa=True&quot;</span><span class="p">)</span>
            <span class="n">pa</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;pa&quot;</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="o">**</span><span class="n">pars</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sin2psi</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;sin2psi&quot;</span><span class="p">,</span> <span class="n">sin2psi</span><span class="p">,</span> <span class="o">**</span><span class="n">pars</span><span class="p">)</span>
            <span class="n">cos2psi</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;cos2psi&quot;</span><span class="p">,</span> <span class="n">cos2psi</span><span class="p">,</span> <span class="o">**</span><span class="n">pars</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">ctime</span><span class="o">.</span><span class="n">size</span>

        <span class="k">if</span> <span class="n">q_hwp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_pa</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_bore2radecpa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">q_off</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">q_bore</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">sindec</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_bore2rasindec</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">q_off</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">q_bore</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">sin2psi</span><span class="p">,</span> <span class="n">cos2psi</span><span class="p">,</span> <span class="n">n</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_bore2radec</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">q_off</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">q_bore</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">sin2psi</span><span class="p">,</span> <span class="n">cos2psi</span><span class="p">,</span> <span class="n">n</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">q_hwp</span> <span class="o">=</span> <span class="n">check_input</span><span class="p">(</span><span class="s2">&quot;q_hwp&quot;</span><span class="p">,</span> <span class="n">q_hwp</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">q_bore</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">return_pa</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_bore2radecpa_hwp</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">q_off</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">q_bore</span><span class="p">,</span> <span class="n">q_hwp</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">n</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">sindec</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_bore2rasindec_hwp</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span>
                    <span class="n">q_off</span><span class="p">,</span>
                    <span class="n">ctime</span><span class="p">,</span>
                    <span class="n">q_bore</span><span class="p">,</span>
                    <span class="n">q_hwp</span><span class="p">,</span>
                    <span class="n">ra</span><span class="p">,</span>
                    <span class="n">dec</span><span class="p">,</span>
                    <span class="n">sin2psi</span><span class="p">,</span>
                    <span class="n">cos2psi</span><span class="p">,</span>
                    <span class="n">n</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_bore2radec_hwp</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span>
                    <span class="n">q_off</span><span class="p">,</span>
                    <span class="n">ctime</span><span class="p">,</span>
                    <span class="n">q_bore</span><span class="p">,</span>
                    <span class="n">q_hwp</span><span class="p">,</span>
                    <span class="n">ra</span><span class="p">,</span>
                    <span class="n">dec</span><span class="p">,</span>
                    <span class="n">sin2psi</span><span class="p">,</span>
                    <span class="n">cos2psi</span><span class="p">,</span>
                    <span class="n">n</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">return_pa</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ra</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ra</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sin2psi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cos2psi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">sin2psi</span><span class="p">,</span> <span class="n">cos2psi</span></div>


<div class="viewcode-block" id="QPoint.azel2radec">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.azel2radec">[docs]</a>
    <span class="k">def</span> <span class="nf">azel2radec</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">delta_az</span><span class="p">,</span>
        <span class="n">delta_el</span><span class="p">,</span>
        <span class="n">delta_psi</span><span class="p">,</span>
        <span class="n">az</span><span class="p">,</span>
        <span class="n">el</span><span class="p">,</span>
        <span class="n">pitch</span><span class="p">,</span>
        <span class="n">roll</span><span class="p">,</span>
        <span class="n">lon</span><span class="p">,</span>
        <span class="n">lat</span><span class="p">,</span>
        <span class="n">ctime</span><span class="p">,</span>
        <span class="n">hwp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sindec</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">return_pa</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ra</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sin2psi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cos2psi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate the orientation on the sky for a detector offset from</span>
<span class="sd">        boresight, given the boresight attitude (az/el/pitch/roll), location on</span>
<span class="sd">        the earth (lon/lat) and UTC time.  Input vectors must be</span>
<span class="sd">        numpy-array-like and broadcastable to the same shape. Detector offsets</span>
<span class="sd">        are defined assuming the boresight is pointed toward the horizon, and</span>
<span class="sd">        that the boresight polarization axis is along the horizontal.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        delta_az : float</span>
<span class="sd">            Azimuthal offset of the detector in degrees</span>
<span class="sd">        delta_el : float</span>
<span class="sd">            Elevation offset of the detector in degrees</span>
<span class="sd">        delta_psi : float</span>
<span class="sd">            Polarization offset of the detector in degrees</span>
<span class="sd">        az : array_like</span>
<span class="sd">            Boresight azimuth in degrees</span>
<span class="sd">        el : array_like</span>
<span class="sd">            Boresight elevation in degrees</span>
<span class="sd">        pitch : array_like</span>
<span class="sd">            Boresight pitch in degrees.  If None, this term is ignored.</span>
<span class="sd">        roll : array_like</span>
<span class="sd">            Boresight roll in degrees.  If None, this term is ignored.</span>
<span class="sd">        lon : array_like</span>
<span class="sd">            Observer longitude in degrees.</span>
<span class="sd">        lat : array_like</span>
<span class="sd">            Observer latitude in degrees.</span>
<span class="sd">        ctime : array_like</span>
<span class="sd">            Unix time in seconds UTC</span>
<span class="sd">        hwp : array_like, optional</span>
<span class="sd">            HWP angles in degrees</span>
<span class="sd">        sindec : bool, optional</span>
<span class="sd">            If `True`, return sin(dec) instead of dec in degrees (default False)</span>
<span class="sd">        return_pa : bool, optional</span>
<span class="sd">            If `True`, return pa instead of sin2psi/cos2psi</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ra : array_like</span>
<span class="sd">            Detector right ascension in degrees</span>
<span class="sd">        dec/sindec : array_like</span>
<span class="sd">            Detector declination in degrees</span>
<span class="sd">        pa : array_like</span>
<span class="sd">            Detector position angle, if `return_pa` is True</span>
<span class="sd">        sin2psi : array_like</span>
<span class="sd">            Detector polarization orientation, if `return_pa` is False</span>
<span class="sd">        cos2psi : array_like</span>
<span class="sd">            Detector polarization orientation, if `return_pa` is False</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ctime</span> <span class="o">=</span> <span class="n">check_inputs</span><span class="p">(</span>
            <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ctime</span>
        <span class="p">)</span>

        <span class="n">ra</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">az</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">az</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_pa</span><span class="p">:</span>
            <span class="n">pa</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;pa&quot;</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">az</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sin2psi</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;sin2psi&quot;</span><span class="p">,</span> <span class="n">sin2psi</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">az</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
            <span class="n">cos2psi</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;cos2psi&quot;</span><span class="p">,</span> <span class="n">cos2psi</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">az</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">size</span>

        <span class="k">if</span> <span class="n">hwp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_pa</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_azel2radecpa</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span>
                    <span class="n">delta_az</span><span class="p">,</span>
                    <span class="n">delta_el</span><span class="p">,</span>
                    <span class="n">delta_psi</span><span class="p">,</span>
                    <span class="n">az</span><span class="p">,</span>
                    <span class="n">el</span><span class="p">,</span>
                    <span class="n">pitch</span><span class="p">,</span>
                    <span class="n">roll</span><span class="p">,</span>
                    <span class="n">lon</span><span class="p">,</span>
                    <span class="n">lat</span><span class="p">,</span>
                    <span class="n">ctime</span><span class="p">,</span>
                    <span class="n">ra</span><span class="p">,</span>
                    <span class="n">dec</span><span class="p">,</span>
                    <span class="n">pa</span><span class="p">,</span>
                    <span class="n">n</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">sindec</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_azel2rasindec</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span>
                    <span class="n">delta_az</span><span class="p">,</span>
                    <span class="n">delta_el</span><span class="p">,</span>
                    <span class="n">delta_psi</span><span class="p">,</span>
                    <span class="n">az</span><span class="p">,</span>
                    <span class="n">el</span><span class="p">,</span>
                    <span class="n">pitch</span><span class="p">,</span>
                    <span class="n">roll</span><span class="p">,</span>
                    <span class="n">lon</span><span class="p">,</span>
                    <span class="n">lat</span><span class="p">,</span>
                    <span class="n">ctime</span><span class="p">,</span>
                    <span class="n">ra</span><span class="p">,</span>
                    <span class="n">dec</span><span class="p">,</span>
                    <span class="n">sin2psi</span><span class="p">,</span>
                    <span class="n">cos2psi</span><span class="p">,</span>
                    <span class="n">n</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_azel2radec</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span>
                    <span class="n">delta_az</span><span class="p">,</span>
                    <span class="n">delta_el</span><span class="p">,</span>
                    <span class="n">delta_psi</span><span class="p">,</span>
                    <span class="n">az</span><span class="p">,</span>
                    <span class="n">el</span><span class="p">,</span>
                    <span class="n">pitch</span><span class="p">,</span>
                    <span class="n">roll</span><span class="p">,</span>
                    <span class="n">lon</span><span class="p">,</span>
                    <span class="n">lat</span><span class="p">,</span>
                    <span class="n">ctime</span><span class="p">,</span>
                    <span class="n">ra</span><span class="p">,</span>
                    <span class="n">dec</span><span class="p">,</span>
                    <span class="n">sin2psi</span><span class="p">,</span>
                    <span class="n">cos2psi</span><span class="p">,</span>
                    <span class="n">n</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hwp</span> <span class="o">=</span> <span class="n">check_input</span><span class="p">(</span><span class="s2">&quot;hwp&quot;</span><span class="p">,</span> <span class="n">hwp</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">az</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">return_pa</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_azel2radec_hwp</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span>
                    <span class="n">delta_az</span><span class="p">,</span>
                    <span class="n">delta_el</span><span class="p">,</span>
                    <span class="n">delta_psi</span><span class="p">,</span>
                    <span class="n">az</span><span class="p">,</span>
                    <span class="n">el</span><span class="p">,</span>
                    <span class="n">pitch</span><span class="p">,</span>
                    <span class="n">roll</span><span class="p">,</span>
                    <span class="n">lon</span><span class="p">,</span>
                    <span class="n">lat</span><span class="p">,</span>
                    <span class="n">ctime</span><span class="p">,</span>
                    <span class="n">hwp</span><span class="p">,</span>
                    <span class="n">ra</span><span class="p">,</span>
                    <span class="n">dec</span><span class="p">,</span>
                    <span class="n">pa</span><span class="p">,</span>
                    <span class="n">n</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">sindec</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_azel2rasindec_hwp</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span>
                    <span class="n">delta_az</span><span class="p">,</span>
                    <span class="n">delta_el</span><span class="p">,</span>
                    <span class="n">delta_psi</span><span class="p">,</span>
                    <span class="n">az</span><span class="p">,</span>
                    <span class="n">el</span><span class="p">,</span>
                    <span class="n">pitch</span><span class="p">,</span>
                    <span class="n">roll</span><span class="p">,</span>
                    <span class="n">lon</span><span class="p">,</span>
                    <span class="n">lat</span><span class="p">,</span>
                    <span class="n">ctime</span><span class="p">,</span>
                    <span class="n">hwp</span><span class="p">,</span>
                    <span class="n">ra</span><span class="p">,</span>
                    <span class="n">dec</span><span class="p">,</span>
                    <span class="n">sin2psi</span><span class="p">,</span>
                    <span class="n">cos2psi</span><span class="p">,</span>
                    <span class="n">n</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_azel2radec_hwp</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span>
                    <span class="n">delta_az</span><span class="p">,</span>
                    <span class="n">delta_el</span><span class="p">,</span>
                    <span class="n">delta_psi</span><span class="p">,</span>
                    <span class="n">az</span><span class="p">,</span>
                    <span class="n">el</span><span class="p">,</span>
                    <span class="n">pitch</span><span class="p">,</span>
                    <span class="n">roll</span><span class="p">,</span>
                    <span class="n">lon</span><span class="p">,</span>
                    <span class="n">lat</span><span class="p">,</span>
                    <span class="n">ctime</span><span class="p">,</span>
                    <span class="n">hwp</span><span class="p">,</span>
                    <span class="n">ra</span><span class="p">,</span>
                    <span class="n">dec</span><span class="p">,</span>
                    <span class="n">sin2psi</span><span class="p">,</span>
                    <span class="n">cos2psi</span><span class="p">,</span>
                    <span class="n">n</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">return_pa</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span>
        <span class="k">return</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">sin2psi</span><span class="p">,</span> <span class="n">cos2psi</span></div>


<div class="viewcode-block" id="QPoint.azelpsi2radec">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.azelpsi2radec">[docs]</a>
    <span class="k">def</span> <span class="nf">azelpsi2radec</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">delta_az</span><span class="p">,</span>
        <span class="n">delta_el</span><span class="p">,</span>
        <span class="n">delta_psi</span><span class="p">,</span>
        <span class="n">az</span><span class="p">,</span>
        <span class="n">el</span><span class="p">,</span>
        <span class="n">psi</span><span class="p">,</span>
        <span class="n">pitch</span><span class="p">,</span>
        <span class="n">roll</span><span class="p">,</span>
        <span class="n">lon</span><span class="p">,</span>
        <span class="n">lat</span><span class="p">,</span>
        <span class="n">ctime</span><span class="p">,</span>
        <span class="n">hwp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sindec</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">return_pa</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ra</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sin2psi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cos2psi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate the orientation on the sky for a detector offset from</span>
<span class="sd">        boresight, given the boresight attitude (az/el/pitch/roll), location on</span>
<span class="sd">        the earth (lon/lat) and UTC time.  Input vectors must be</span>
<span class="sd">        numpy-array-like and broadcastable to the same shape. Detector offsets</span>
<span class="sd">        are defined assuming the boresight is pointed toward the horizon, and</span>
<span class="sd">        that the boresight polarization axis is along the horizontal.</span>

<span class="sd">        This is agumented from azel2radec(), to accept rotations of the focal</span>
<span class="sd">        plane about the optical axis.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        delta_az : float</span>
<span class="sd">            Azimuthal offset of the detector in degrees</span>
<span class="sd">        delta_el : float</span>
<span class="sd">            Elevation offset of the detector in degrees</span>
<span class="sd">        delta_psi : float</span>
<span class="sd">            Polarization offset of the detector in degrees</span>
<span class="sd">        az : array_like</span>
<span class="sd">            Boresight azimuth in degrees</span>
<span class="sd">        el : array_like</span>
<span class="sd">            Boresight elevation in degrees</span>
<span class="sd">        psi : array_like</span>
<span class="sd">            Boresight rotation in degrees</span>
<span class="sd">        pitch : array_like</span>
<span class="sd">            Boresight pitch in degrees.  If None, this term is ignored.</span>
<span class="sd">        roll : array_like</span>
<span class="sd">            Boresight roll in degrees.  If None, this term is ignored.</span>
<span class="sd">        lon : array_like</span>
<span class="sd">            Observer longitude in degrees.</span>
<span class="sd">        lat : array_like</span>
<span class="sd">            Observer latitude in degrees.</span>
<span class="sd">        ctime : array_like</span>
<span class="sd">            Unix time in seconds UTC</span>
<span class="sd">        hwp : array_like, optional</span>
<span class="sd">            HWP angles in degrees</span>
<span class="sd">        sindec : bool, optional</span>
<span class="sd">            If `True`, return sin(dec) instead of dec in degrees (default False)</span>
<span class="sd">        return_pa : bool, optional</span>
<span class="sd">            If `True`, return pa instead of sin2psi/cos2psi</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ra : array_like</span>
<span class="sd">            Detector right ascension in degrees</span>
<span class="sd">        dec/sindec : array_like</span>
<span class="sd">            Detector declination in degrees</span>
<span class="sd">        pa : array_like</span>
<span class="sd">            Detector position angle, if `return_pa` is True</span>
<span class="sd">        sin2psi : array_like</span>
<span class="sd">            Detector polarization orientation, if `return_pa` is False</span>
<span class="sd">        cos2psi : array_like</span>
<span class="sd">            Detector polarization orientation, if `return_pa` is False</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ctime</span> <span class="o">=</span> <span class="n">check_inputs</span><span class="p">(</span>
            <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ctime</span>
        <span class="p">)</span>

        <span class="n">ra</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">az</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">az</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_pa</span><span class="p">:</span>
            <span class="n">pa</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;pa&quot;</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">az</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sin2psi</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;sin2psi&quot;</span><span class="p">,</span> <span class="n">sin2psi</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">az</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
            <span class="n">cos2psi</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;cos2psi&quot;</span><span class="p">,</span> <span class="n">cos2psi</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">az</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">az</span><span class="o">.</span><span class="n">size</span>

        <span class="k">if</span> <span class="n">hwp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_pa</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_azelpsi2radecpa</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span>
                    <span class="n">delta_az</span><span class="p">,</span>
                    <span class="n">delta_el</span><span class="p">,</span>
                    <span class="n">delta_psi</span><span class="p">,</span>
                    <span class="n">az</span><span class="p">,</span>
                    <span class="n">el</span><span class="p">,</span>
                    <span class="n">psi</span><span class="p">,</span>
                    <span class="n">pitch</span><span class="p">,</span>
                    <span class="n">roll</span><span class="p">,</span>
                    <span class="n">lon</span><span class="p">,</span>
                    <span class="n">lat</span><span class="p">,</span>
                    <span class="n">ctime</span><span class="p">,</span>
                    <span class="n">ra</span><span class="p">,</span>
                    <span class="n">dec</span><span class="p">,</span>
                    <span class="n">pa</span><span class="p">,</span>
                    <span class="n">n</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">sindec</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_azelpsi2rasindec</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span>
                    <span class="n">delta_az</span><span class="p">,</span>
                    <span class="n">delta_el</span><span class="p">,</span>
                    <span class="n">delta_psi</span><span class="p">,</span>
                    <span class="n">az</span><span class="p">,</span>
                    <span class="n">el</span><span class="p">,</span>
                    <span class="n">psi</span><span class="p">,</span>
                    <span class="n">pitch</span><span class="p">,</span>
                    <span class="n">roll</span><span class="p">,</span>
                    <span class="n">lon</span><span class="p">,</span>
                    <span class="n">lat</span><span class="p">,</span>
                    <span class="n">ctime</span><span class="p">,</span>
                    <span class="n">ra</span><span class="p">,</span>
                    <span class="n">dec</span><span class="p">,</span>
                    <span class="n">sin2psi</span><span class="p">,</span>
                    <span class="n">cos2psi</span><span class="p">,</span>
                    <span class="n">n</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_azelpsi2radec</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span>
                    <span class="n">delta_az</span><span class="p">,</span>
                    <span class="n">delta_el</span><span class="p">,</span>
                    <span class="n">delta_psi</span><span class="p">,</span>
                    <span class="n">az</span><span class="p">,</span>
                    <span class="n">el</span><span class="p">,</span>
                    <span class="n">psi</span><span class="p">,</span>
                    <span class="n">pitch</span><span class="p">,</span>
                    <span class="n">roll</span><span class="p">,</span>
                    <span class="n">lon</span><span class="p">,</span>
                    <span class="n">lat</span><span class="p">,</span>
                    <span class="n">ctime</span><span class="p">,</span>
                    <span class="n">ra</span><span class="p">,</span>
                    <span class="n">dec</span><span class="p">,</span>
                    <span class="n">sin2psi</span><span class="p">,</span>
                    <span class="n">cos2psi</span><span class="p">,</span>
                    <span class="n">n</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hwp</span> <span class="o">=</span> <span class="n">check_input</span><span class="p">(</span><span class="s2">&quot;hwp&quot;</span><span class="p">,</span> <span class="n">hwp</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">az</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">return_pa</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_azelpsi2radec_hwp</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span>
                    <span class="n">delta_az</span><span class="p">,</span>
                    <span class="n">delta_el</span><span class="p">,</span>
                    <span class="n">delta_psi</span><span class="p">,</span>
                    <span class="n">az</span><span class="p">,</span>
                    <span class="n">el</span><span class="p">,</span>
                    <span class="n">psi</span><span class="p">,</span>
                    <span class="n">pitch</span><span class="p">,</span>
                    <span class="n">roll</span><span class="p">,</span>
                    <span class="n">lon</span><span class="p">,</span>
                    <span class="n">lat</span><span class="p">,</span>
                    <span class="n">ctime</span><span class="p">,</span>
                    <span class="n">hwp</span><span class="p">,</span>
                    <span class="n">ra</span><span class="p">,</span>
                    <span class="n">dec</span><span class="p">,</span>
                    <span class="n">pa</span><span class="p">,</span>
                    <span class="n">n</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">sindec</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_azelpsi2rasindec_hwp</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span>
                    <span class="n">delta_az</span><span class="p">,</span>
                    <span class="n">delta_el</span><span class="p">,</span>
                    <span class="n">delta_psi</span><span class="p">,</span>
                    <span class="n">az</span><span class="p">,</span>
                    <span class="n">el</span><span class="p">,</span>
                    <span class="n">psi</span><span class="p">,</span>
                    <span class="n">pitch</span><span class="p">,</span>
                    <span class="n">roll</span><span class="p">,</span>
                    <span class="n">lon</span><span class="p">,</span>
                    <span class="n">lat</span><span class="p">,</span>
                    <span class="n">ctime</span><span class="p">,</span>
                    <span class="n">hwp</span><span class="p">,</span>
                    <span class="n">ra</span><span class="p">,</span>
                    <span class="n">dec</span><span class="p">,</span>
                    <span class="n">sin2psi</span><span class="p">,</span>
                    <span class="n">cos2psi</span><span class="p">,</span>
                    <span class="n">n</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_azelpsi2radec_hwp</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span>
                    <span class="n">delta_az</span><span class="p">,</span>
                    <span class="n">delta_el</span><span class="p">,</span>
                    <span class="n">delta_psi</span><span class="p">,</span>
                    <span class="n">az</span><span class="p">,</span>
                    <span class="n">el</span><span class="p">,</span>
                    <span class="n">psi</span><span class="p">,</span>
                    <span class="n">pitch</span><span class="p">,</span>
                    <span class="n">roll</span><span class="p">,</span>
                    <span class="n">lon</span><span class="p">,</span>
                    <span class="n">lat</span><span class="p">,</span>
                    <span class="n">ctime</span><span class="p">,</span>
                    <span class="n">hwp</span><span class="p">,</span>
                    <span class="n">ra</span><span class="p">,</span>
                    <span class="n">dec</span><span class="p">,</span>
                    <span class="n">sin2psi</span><span class="p">,</span>
                    <span class="n">cos2psi</span><span class="p">,</span>
                    <span class="n">n</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">return_pa</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span>
        <span class="k">return</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">sin2psi</span><span class="p">,</span> <span class="n">cos2psi</span></div>


<div class="viewcode-block" id="QPoint.radec2azel">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.radec2azel">[docs]</a>
    <span class="k">def</span> <span class="nf">radec2azel</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">az</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">el</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hpa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate the horizon coordinates for a given set of equatorial coordinates</span>
<span class="sd">        (ra/dec/psi), location on the earth (lon/lat) and UTC time.  Input vectors</span>
<span class="sd">        must be numpy-array-like and broadcastable to the same shape.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        ra : array_like</span>
<span class="sd">            Right ascension angle</span>
<span class="sd">        dec : array_like</span>
<span class="sd">            Declination angle</span>
<span class="sd">        pa : array_like</span>
<span class="sd">            Position angle in equatorial coordinates</span>
<span class="sd">        lon : array_like</span>
<span class="sd">            Observer longitude in degrees.</span>
<span class="sd">        lat : array_like</span>
<span class="sd">            Observer latitude in degrees.</span>
<span class="sd">        ctime : array_like</span>
<span class="sd">            Unix time in seconds UTC</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        az : array_like</span>
<span class="sd">            Azimuth in degrees</span>
<span class="sd">        el : array_like</span>
<span class="sd">            Elevation in degrees</span>
<span class="sd">        hpa : array_like</span>
<span class="sd">            Position angle in horizon coordinates</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ctime</span> <span class="o">=</span> <span class="n">check_inputs</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ctime</span><span class="p">)</span>

        <span class="n">az</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;az&quot;</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">ra</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="n">el</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;el&quot;</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">ra</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="n">hpa</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;hpa&quot;</span><span class="p">,</span> <span class="n">hpa</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">ra</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">ra</span><span class="o">.</span><span class="n">size</span>

        <span class="n">qp</span><span class="o">.</span><span class="n">qp_radec2azel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">hpa</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">az</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">hpa</span></div>


<div class="viewcode-block" id="QPoint.radecpa2quat">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.radecpa2quat">[docs]</a>
    <span class="k">def</span> <span class="nf">radecpa2quat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate quaternion for input ra/dec/pa. Vectorized, input arguments</span>
<span class="sd">        must be broadcastable to the same shape.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        ra : array_like</span>
<span class="sd">            Right ascension angle</span>
<span class="sd">        dec : array_like</span>
<span class="sd">            Declination angle</span>
<span class="sd">        pa : array_like</span>
<span class="sd">            Position angle</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        q : array_like</span>
<span class="sd">            Quaternion constructed from the input angles.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span> <span class="o">=</span> <span class="n">check_inputs</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">ra</span><span class="o">.</span><span class="n">size</span>
        <span class="n">quat</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;quat&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">qp</span><span class="o">.</span><span class="n">qp_radecpa2quatn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">quat</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">quat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">quat</span></div>


<div class="viewcode-block" id="QPoint.quat2radecpa">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.quat2radecpa">[docs]</a>
    <span class="k">def</span> <span class="nf">quat2radecpa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quat</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate ra/dec/pa for input quaternion(s).</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        q : array_like</span>
<span class="sd">            Pointing quaternion</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ra : array_like</span>
<span class="sd">            Right ascension angle</span>
<span class="sd">        dec : array_like</span>
<span class="sd">            Declination angle</span>
<span class="sd">        pa : array_like</span>
<span class="sd">            Position angle</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">quat</span> <span class="o">=</span> <span class="n">check_input</span><span class="p">(</span><span class="s2">&quot;quat&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">quat</span><span class="p">),</span> <span class="n">quat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">quat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ra</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;ra&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">dec</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;dec&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">pa</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;pa&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">qp</span><span class="o">.</span><span class="n">qp_quat2radecpan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">quat</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ra</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span></div>


<div class="viewcode-block" id="QPoint.quat2pixpa">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.quat2pixpa">[docs]</a>
    <span class="k">def</span> <span class="nf">quat2pixpa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quat</span><span class="p">,</span> <span class="n">nside</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate ra/dec/pa for input quaternion(s).</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        q : array_like</span>
<span class="sd">            Pointing quaternion</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pix : array_like</span>
<span class="sd">            Pixel number(s) corresponding to the input positions(s).</span>
<span class="sd">        pa : array_like</span>
<span class="sd">            Position angle</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">quat</span> <span class="o">=</span> <span class="n">check_input</span><span class="p">(</span><span class="s2">&quot;quat&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">quat</span><span class="p">),</span> <span class="n">quat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">quat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">pix</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;pix&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">pa</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;pa&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">qp</span><span class="o">.</span><span class="n">qp_quat2pixpan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">quat</span><span class="p">,</span> <span class="n">pix</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pix</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">pix</span><span class="p">,</span> <span class="n">pa</span></div>


<div class="viewcode-block" id="QPoint.radec2pix">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.radec2pix">[docs]</a>
    <span class="k">def</span> <span class="nf">radec2pix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">nside</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate HEALpix pixel number for given ra/dec and nside.  Vectorized,</span>
<span class="sd">        input arguments must be broadcastable to the same shape.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        ra : array_like</span>
<span class="sd">            Right ascension angle</span>
<span class="sd">        dec : array_like</span>
<span class="sd">            Declination angle</span>
<span class="sd">        nside : int</span>
<span class="sd">            HEALpix resolution parameter</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pix : array_like</span>
<span class="sd">            Pixel number(s) corresponding to the input positions(s).</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">check_inputs</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">ra</span><span class="o">.</span><span class="n">size</span>

        <span class="n">pix</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;pix&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">ra</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">qp</span><span class="o">.</span><span class="n">qp_radec2pixn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">nside</span><span class="p">,</span> <span class="n">pix</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">pix</span></div>


<div class="viewcode-block" id="QPoint.rotate_quat">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.rotate_quat">[docs]</a>
    <span class="k">def</span> <span class="nf">rotate_quat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quat</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;G&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotate a quaternion from one coordinate system to another.</span>
<span class="sd">        Supported coordinates:</span>

<span class="sd">        C: celestial (equatorial) coordinates</span>
<span class="sd">        G: galactic coordinates</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        quat : array_like</span>
<span class="sd">            array of quaternions, of shape (n, 4)</span>
<span class="sd">        coord : list, optional</span>
<span class="sd">            2-element list of input and output coordinates</span>
<span class="sd">        inplace : bool, optional</span>
<span class="sd">            If True, apply the rotation in-place on the input quaternion.</span>
<span class="sd">            Otherwise, return a copy of the input array.  Default: True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        quat : array_like</span>
<span class="sd">            rotated quaternion array</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">quat</span> <span class="o">=</span> <span class="n">check_input</span><span class="p">(</span>
            <span class="s2">&quot;quat&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">quat</span><span class="p">),</span> <span class="n">quat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="n">inplace</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">quat</span><span class="o">.</span><span class="n">size</span> <span class="o">//</span> <span class="mi">4</span>

        <span class="k">if</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;G&quot;</span><span class="p">:</span>
            <span class="n">qp</span><span class="o">.</span><span class="n">qp_radec2gal_quatn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">quat</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;G&quot;</span> <span class="ow">and</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span>
            <span class="n">qp</span><span class="o">.</span><span class="n">qp_gal2radec_quatn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">quat</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;unsupported coord </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">coord</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">quat</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span></div>


<div class="viewcode-block" id="QPoint.rotate_coord">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.rotate_coord">[docs]</a>
    <span class="k">def</span> <span class="nf">rotate_coord</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ra</span><span class="p">,</span>
        <span class="n">dec</span><span class="p">,</span>
        <span class="n">pa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sin2psi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cos2psi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">coord</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;G&quot;</span><span class="p">],</span>
        <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotate coordinates from one coordinate system to another. Vectorized,</span>
<span class="sd">        input arguments must be broadcastable to the same shape.</span>
<span class="sd">        Supported coordinates:</span>

<span class="sd">        C: celestial (equatorial) coordinates</span>
<span class="sd">        G: galactic coordinates</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        ra, dec, pa : array_like</span>
<span class="sd">          -- or --</span>
<span class="sd">        ra, dec, sin2psi, cos2psi : array_like</span>
<span class="sd">            arrays of coordinates, of shape (n,)</span>
<span class="sd">            If none of pa, sin2psi or cos2psi are supplied,</span>
<span class="sd">            pa = 0 is assumed.</span>
<span class="sd">        coord : list, optional</span>
<span class="sd">            2-element list of input and output coordinates.</span>
<span class="sd">            Supported systems: C, G.</span>
<span class="sd">        inplace : bool, optional</span>
<span class="sd">            If True, apply the rotation in-place on the input coordinates.</span>
<span class="sd">            Otherwise, return a copy of the input array.  Default: True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ra, dec, pa : array_like</span>
<span class="sd">          -- or --</span>
<span class="sd">        ra, dec, sin2psi, cos2psi : array_like</span>
<span class="sd">            rotated coordinate arrays, same form as input</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">do_pa</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">pa</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sin2psi</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cos2psi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">sin2psi</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cos2psi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;both sin2psi and cos2psi arguments required&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">do_pa</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sin2psi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cos2psi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                    <span class="s2">&quot;ambiguous pol arguments, supply either pa &quot;</span>
                    <span class="s2">&quot;or sin2psi/cos2psi only&quot;</span>
                <span class="p">)</span>

        <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">sin2psi</span><span class="p">,</span> <span class="n">cos2psi</span> <span class="o">=</span> <span class="n">check_inputs</span><span class="p">(</span>
            <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">sin2psi</span><span class="p">,</span> <span class="n">cos2psi</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="n">inplace</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">ra</span><span class="o">.</span><span class="n">size</span>

        <span class="k">if</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span> <span class="ow">and</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;G&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">do_pa</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_radecpa2galn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_radec2galn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">sin2psi</span><span class="p">,</span> <span class="n">cos2psi</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;G&quot;</span> <span class="ow">and</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">do_pa</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_gal2radecpan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_gal2radecn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">sin2psi</span><span class="p">,</span> <span class="n">cos2psi</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">do_pa</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ra</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">ra</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sin2psi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cos2psi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">do_pa</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span>
        <span class="k">return</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">sin2psi</span><span class="p">,</span> <span class="n">cos2psi</span></div>


<div class="viewcode-block" id="QPoint.radec2gal">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.radec2gal">[docs]</a>
    <span class="k">def</span> <span class="nf">radec2gal</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sin2psi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cos2psi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotate celestial (equatorial) coordinates to galactic coordinates.  This</span>
<span class="sd">        is equivalent to calling :meth:`rotate_coord` with `coord=[&#39;C&#39;, &#39;G&#39;]`.</span>
<span class="sd">        Vectorized, input arguments must be broadcastable to the same shape.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        ra, dec, pa : array_like</span>
<span class="sd">          -- or --</span>
<span class="sd">        ra, dec, sin2psi, cos2psi : array_like</span>
<span class="sd">            arrays of coordinates, of shape (n,).  If none of pa, sin2psi or</span>
<span class="sd">            cos2psi are supplied, pa = 0 is assumed.</span>
<span class="sd">        inplace : bool, optional</span>
<span class="sd">            If True, apply the rotation in-place on the input quaternion.</span>
<span class="sd">            Otherwise, return a copy of the input array.  Default: True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        l, b, pa : array_like</span>
<span class="sd">          -- or --</span>
<span class="sd">        l, b, sin2psi, cos2psi : array_like</span>
<span class="sd">            rotated coordinate arrays, same form as input</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_coord</span><span class="p">(</span>
            <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">sin2psi</span><span class="p">,</span> <span class="n">cos2psi</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;G&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="n">inplace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="QPoint.gal2radec">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.gal2radec">[docs]</a>
    <span class="k">def</span> <span class="nf">gal2radec</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sin2psi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cos2psi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotate galactic coordinates to celestial (equatorial) coordinates.  This</span>
<span class="sd">        is equivalent to calling :meth:`rotate_coord` with `coord=[&#39;G&#39;, &#39;C&#39;]`.</span>
<span class="sd">        Vectorized, input arguments must be broadcastable to the same shape.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        l, b, pa : array_like</span>
<span class="sd">          -- or --</span>
<span class="sd">        l, b, sin2psi, cos2psi : array_like</span>
<span class="sd">            arrays of coordinates, of shape (n,).  If none of pa, sin2psi or</span>
<span class="sd">            cos2psi are supplied, pa = 0 is assumed.</span>
<span class="sd">        inplace : bool, optional</span>
<span class="sd">            If True, apply the rotation in-place on the input quaternion.</span>
<span class="sd">            Otherwise, return a copy of the input array.  Default: True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ra, dec, pa : array_like</span>
<span class="sd">          -- or --</span>
<span class="sd">        ra, dec, sin2psi, cos2psi : array_like</span>
<span class="sd">            rotated coordinate arrays, same form as input</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_coord</span><span class="p">(</span>
            <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">sin2psi</span><span class="p">,</span> <span class="n">cos2psi</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;G&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="n">inplace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="QPoint.rotate_map">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.rotate_map">[docs]</a>
    <span class="k">def</span> <span class="nf">rotate_map</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">map_in</span><span class="p">,</span> <span class="n">coord</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;G&quot;</span><span class="p">],</span> <span class="n">map_out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interp_pix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotate a polarized 3-x-npix map from one coordinate system to another.</span>
<span class="sd">        Supported coordinates:</span>

<span class="sd">        C = celestial (equatorial J2000)</span>
<span class="sd">        G = galactic</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        map_in : array_like</span>
<span class="sd">            Input map, of shape (3, N)</span>
<span class="sd">        coord : list, optional</span>
<span class="sd">            2-element list of input and output coordinates.</span>
<span class="sd">            Supported systems: C, G.</span>
<span class="sd">        map_out : array_like, optional</span>
<span class="sd">            Rotated output map, for inplace operation.  Same shape as `map_in`.</span>
<span class="sd">        interp_pix : bool, optional</span>
<span class="sd">            If True, interpolate the rotated map.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        map_out : array_like</span>
<span class="sd">            Rotated output map.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>

<span class="sd">        Only full-sky maps are currently supported.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;This code is buggy, use at your own risk&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>

        <span class="n">interp_orig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;interp_pix&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">interp_pix</span><span class="o">=</span><span class="n">interp_pix</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">.qmap_class</span> <span class="kn">import</span> <span class="n">check_map</span>

        <span class="n">map_in</span><span class="p">,</span> <span class="n">nside</span> <span class="o">=</span> <span class="n">check_map</span><span class="p">(</span><span class="n">map_in</span><span class="p">)</span>
        <span class="n">map_out</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span>
            <span class="s2">&quot;map_out&quot;</span><span class="p">,</span> <span class="n">map_out</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">map_in</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">map_in</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">coord_in</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">coord_out</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;unable to parse coord&quot;</span><span class="p">)</span>

        <span class="n">map_in_p</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">pointer_2d</span><span class="p">(</span><span class="n">map_in</span><span class="p">)</span>
        <span class="n">map_out_p</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">pointer_2d</span><span class="p">(</span><span class="n">map_out</span><span class="p">)</span>

        <span class="n">qp</span><span class="o">.</span><span class="n">qp_rotate_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">nside</span><span class="p">,</span> <span class="n">map_in_p</span><span class="p">,</span> <span class="n">coord_in</span><span class="p">,</span> <span class="n">map_out_p</span><span class="p">,</span> <span class="n">coord_out</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">interp_pix</span><span class="o">=</span><span class="n">interp_orig</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">map_out</span></div>


<div class="viewcode-block" id="QPoint.quat2pix">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.quat2pix">[docs]</a>
    <span class="k">def</span> <span class="nf">quat2pix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quat</span><span class="p">,</span> <span class="n">nside</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">pol</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate HEALpix pixel number and optional polarization angle</span>
<span class="sd">        for a given orientation.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        quat : quaternion or array of quaternions</span>
<span class="sd">            Pointing orientation(s)</span>
<span class="sd">        nside : int, optional</span>
<span class="sd">            HEALpix resolution parameter</span>
<span class="sd">        pol : bool, optional</span>
<span class="sd">            If True, return sin2psi and cos2psi along with the pixel number(s)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pix : array_like</span>
<span class="sd">            Pixel number(s) for the given input quaternion(s)</span>
<span class="sd">        sin2psi : array_like</span>
<span class="sd">        cos2psi : array_like</span>
<span class="sd">            Polarization coefficients, if `pol` is `True`.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">quat</span> <span class="o">=</span> <span class="n">check_input</span><span class="p">(</span><span class="s2">&quot;quat&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">quat</span><span class="p">),</span> <span class="n">quat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">quat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="p">,)</span>
        <span class="n">pix</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;pix&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">sin2psi</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;sin2psi&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">cos2psi</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;cos2psi&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">qp</span><span class="o">.</span><span class="n">qp_quat2pixn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">quat</span><span class="p">,</span> <span class="n">nside</span><span class="p">,</span> <span class="n">pix</span><span class="p">,</span> <span class="n">sin2psi</span><span class="p">,</span> <span class="n">cos2psi</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pix</span><span class="p">,</span> <span class="n">sin2psi</span><span class="p">,</span> <span class="n">cos2psi</span> <span class="o">=</span> <span class="n">pix</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sin2psi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cos2psi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">pol</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pix</span><span class="p">,</span> <span class="n">sin2psi</span><span class="p">,</span> <span class="n">cos2psi</span>
        <span class="k">return</span> <span class="n">pix</span></div>


<div class="viewcode-block" id="QPoint.bore2pix">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.bore2pix">[docs]</a>
    <span class="k">def</span> <span class="nf">bore2pix</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">q_off</span><span class="p">,</span>
        <span class="n">ctime</span><span class="p">,</span>
        <span class="n">q_bore</span><span class="p">,</span>
        <span class="n">q_hwp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nside</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span>
        <span class="n">pol</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">return_pa</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the orientation on the sky for a detector offset from the</span>
<span class="sd">        boresight.  Detector offsets are defined assuming the boresight is</span>
<span class="sd">        pointed toward the horizon, and that the boresight polarization axis is</span>
<span class="sd">        along the vertical.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        q_off : quaternion</span>
<span class="sd">            Detector offset quaternion for a single detector,</span>
<span class="sd">            calculated using :meth:`det_offset`.</span>
<span class="sd">        ctime : array_like</span>
<span class="sd">            Unix times in seconds UTC, broadcastable to shape (N,),</span>
<span class="sd">            the long dimenions of `q_bore`.</span>
<span class="sd">        q_bore : quaternion or array of quaternions</span>
<span class="sd">            Nx4 array of quaternions encoding the boresight orientation on the</span>
<span class="sd">            sky (as output by :meth:`azel2radec` or equivalent)</span>
<span class="sd">        q_hwp : quaternion or array of quaternions, optional</span>
<span class="sd">            HWP angle quaternions calculated using :meth:`hwp_quat`.  Must be</span>
<span class="sd">            broadcastable to the same shape as `q_bore`.</span>
<span class="sd">        nside : int, optional</span>
<span class="sd">            HEALpix map dimension.  Default: 256.</span>
<span class="sd">        pol : bool, optional</span>
<span class="sd">            If `False`, return only the pixel timestream</span>
<span class="sd">        return_pa : bool, optional</span>
<span class="sd">            If `True`, return pa instead of sin2psi / cos2psi</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pix : array_like</span>
<span class="sd">            Detector pixel number</span>
<span class="sd">        pa/sin2psi : array_like</span>
<span class="sd">            Detector polarization orientation if `return_pa` is `True`, or</span>
<span class="sd">            sin(2*pa) if `return_pa` is `False`.</span>
<span class="sd">        cos2psi : array_like</span>
<span class="sd">            detector polarization orientation cos(2*pa), if `return_pa` is `False`.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Any keywords accepted by the :meth:`set` method can also be passed here,</span>
<span class="sd">        and will be processed prior to calculation.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">q_off</span> <span class="o">=</span> <span class="n">check_input</span><span class="p">(</span><span class="s2">&quot;q_off&quot;</span><span class="p">,</span> <span class="n">q_off</span><span class="p">,</span> <span class="n">quat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">q_bore</span> <span class="o">=</span> <span class="n">check_input</span><span class="p">(</span><span class="s2">&quot;q_bore&quot;</span><span class="p">,</span> <span class="n">q_bore</span><span class="p">,</span> <span class="n">quat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ctime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mean_aber&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ctime required if mean_aber is False&quot;</span><span class="p">)</span>
            <span class="n">ctime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">q_bore</span><span class="o">.</span><span class="n">size</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">q_bore</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">ctime</span> <span class="o">=</span> <span class="n">check_input</span><span class="p">(</span><span class="s2">&quot;ctime&quot;</span><span class="p">,</span> <span class="n">ctime</span><span class="p">)</span>
        <span class="n">pix</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;pix&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">ctime</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">return_pa</span><span class="p">:</span>
            <span class="n">pa</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;pa&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">ctime</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sin2psi</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;sin2psi&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">ctime</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">cos2psi</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;cos2psi&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">ctime</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">ctime</span><span class="o">.</span><span class="n">size</span>

        <span class="k">if</span> <span class="n">q_hwp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_pa</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_bore2pixpa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">q_off</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">q_bore</span><span class="p">,</span> <span class="n">nside</span><span class="p">,</span> <span class="n">pix</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_bore2pix</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">q_off</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">q_bore</span><span class="p">,</span> <span class="n">nside</span><span class="p">,</span> <span class="n">pix</span><span class="p">,</span> <span class="n">sin2psi</span><span class="p">,</span> <span class="n">cos2psi</span><span class="p">,</span> <span class="n">n</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">q_hwp</span> <span class="o">=</span> <span class="n">check_input</span><span class="p">(</span><span class="s2">&quot;q_hwp&quot;</span><span class="p">,</span> <span class="n">q_hwp</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">q_bore</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">return_pa</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_bore2pixpa_hwp</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">q_off</span><span class="p">,</span> <span class="n">ctime</span><span class="p">,</span> <span class="n">q_bore</span><span class="p">,</span> <span class="n">q_hwp</span><span class="p">,</span> <span class="n">nside</span><span class="p">,</span> <span class="n">pix</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">n</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qp</span><span class="o">.</span><span class="n">qp_bore2pix_hwp</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span>
                    <span class="n">q_off</span><span class="p">,</span>
                    <span class="n">ctime</span><span class="p">,</span>
                    <span class="n">q_bore</span><span class="p">,</span>
                    <span class="n">q_hwp</span><span class="p">,</span>
                    <span class="n">nside</span><span class="p">,</span>
                    <span class="n">pix</span><span class="p">,</span>
                    <span class="n">sin2psi</span><span class="p">,</span>
                    <span class="n">cos2psi</span><span class="p">,</span>
                    <span class="n">n</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">pol</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">return_pa</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pix</span><span class="p">,</span> <span class="n">pa</span>
            <span class="k">return</span> <span class="n">pix</span><span class="p">,</span> <span class="n">sin2psi</span><span class="p">,</span> <span class="n">cos2psi</span>
        <span class="k">return</span> <span class="n">pix</span></div>


<div class="viewcode-block" id="QPoint.get_interp_val">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.get_interp_val">[docs]</a>
    <span class="k">def</span> <span class="nf">get_interp_val</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">map_in</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">nest</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Interpolate map pixels to these coordinates.  Uses a C implementation</span>
<span class="sd">        of the bilinear interpolation method `get_interpol()` as implemented</span>
<span class="sd">        in the equivalent healpix_cxx / healpy function.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        map_in : array_like</span>
<span class="sd">            A single healpix map or list of maps which to interpolate from.</span>
<span class="sd">        ra, dec: array_like</span>
<span class="sd">            Timestreams of coordinates to interpolate to, in degrees,</span>
<span class="sd">            broadcastable to a common shape (nsample,)</span>
<span class="sd">        nest: bool, optional</span>
<span class="sd">            If True, input map is in the nested pixel ordering scheme.</span>
<span class="sd">            Otherwise, ring ordering is assumed.</span>
<span class="sd">            Default: False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        values : array_like</span>
<span class="sd">            Array of interpolated map values, of shape (nmap, nsample).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pix_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pix_order&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nest</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">pix_order</span><span class="o">=</span><span class="s2">&quot;nest&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">pix_order</span><span class="o">=</span><span class="s2">&quot;ring&quot;</span><span class="p">)</span>

        <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">check_inputs</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">ra</span><span class="o">.</span><span class="n">size</span>

        <span class="kn">from</span> <span class="nn">.qmap_class</span> <span class="kn">import</span> <span class="n">check_map</span>

        <span class="n">map_in</span><span class="p">,</span> <span class="n">nside</span> <span class="o">=</span> <span class="n">check_map</span><span class="p">(</span><span class="n">map_in</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">check_output</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">map_in</span><span class="p">),</span> <span class="n">n</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">map_in</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
            <span class="n">qp</span><span class="o">.</span><span class="n">qp_get_interp_valn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">nside</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">pix_order</span><span class="o">=</span><span class="n">pix_order</span><span class="p">)</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v</span><span class="p">[()]</span>
        <span class="k">return</span> <span class="n">v</span></div>


<div class="viewcode-block" id="QPoint.update_bulletin_a">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.update_bulletin_a">[docs]</a>
    <span class="k">def</span> <span class="nf">update_bulletin_a</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_year</span><span class="o">=</span><span class="mi">2000</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the IERS Bulletin A database using astropy, and return the stored</span>
<span class="sd">        entries.  Issues an ImportWarning if astropy version 1.2 or newer is not</span>
<span class="sd">        found.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        start_year : int, optional</span>
<span class="sd">            Oldest year for which data should be stored.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mjd : array_like</span>
<span class="sd">            Modified Julian date</span>
<span class="sd">        dut1 : array_like</span>
<span class="sd">            UT1-UTC time correction</span>
<span class="sd">        x : array_like</span>
<span class="sd">        y : array_like</span>
<span class="sd">            Polar motion (wobble) corrections</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">astropy.utils.iers</span> <span class="kn">import</span> <span class="n">IERS_Auto</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;Compatible Astropy not found.  Install astropy v1.2 or newer &quot;</span>
                <span class="s2">&quot;for accurate polar motion and UT1 corrections&quot;</span><span class="p">,</span>
                <span class="ne">ImportWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MJD&quot;</span><span class="p">,</span> <span class="s2">&quot;UT1_UTC&quot;</span><span class="p">,</span> <span class="s2">&quot;PM_x&quot;</span><span class="p">,</span> <span class="s2">&quot;PM_y&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">]</span>
        <span class="n">iers_table</span> <span class="o">=</span> <span class="n">IERS_Auto</span><span class="o">.</span><span class="n">open</span><span class="p">()[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span>

        <span class="c1"># check year</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">iers_table</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1900</span>
        <span class="p">(</span><span class="n">wraps</span><span class="p">,)</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ediff1d</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">wraps</span><span class="p">:</span>
            <span class="n">year</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span> <span class="o">+=</span> <span class="mi">100</span>
        <span class="n">iers_table</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year</span>
        <span class="n">iers_table</span> <span class="o">=</span> <span class="n">iers_table</span><span class="p">[</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="n">start_year</span><span class="p">]</span>

        <span class="c1"># check MJD</span>
        <span class="n">mjds</span> <span class="o">=</span> <span class="n">iers_table</span><span class="p">[</span><span class="s2">&quot;MJD&quot;</span><span class="p">]</span>
        <span class="n">mjd_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mjds</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="n">mjd_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mjds</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

        <span class="c1"># update table</span>
        <span class="n">dut1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">iers_table</span><span class="p">[</span><span class="s2">&quot;UT1_UTC&quot;</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">iers_table</span><span class="p">[</span><span class="s2">&quot;PM_x&quot;</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">iers_table</span><span class="p">[</span><span class="s2">&quot;PM_y&quot;</span><span class="p">])</span>
        <span class="n">qp</span><span class="o">.</span><span class="n">qp_set_iers_bulletin_a</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">mjd_min</span><span class="p">,</span> <span class="n">mjd_max</span><span class="p">,</span> <span class="n">dut1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mjds</span><span class="p">,</span> <span class="n">dut1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>


<div class="viewcode-block" id="QPoint.load_bulletin_a">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.load_bulletin_a">[docs]</a>
    <span class="k">def</span> <span class="nf">load_bulletin_a</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mjd&quot;</span><span class="p">,</span> <span class="s2">&quot;dut1&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load IERS Bulletin A from file and store in memory.  The file must be</span>
<span class="sd">        readable using `numpy.loadtxt` with `unpack=True`, and is assumed to be</span>
<span class="sd">        sorted by mjd.</span>

<span class="sd">        Arguments</span>
<span class="sd">        ---------</span>
<span class="sd">        filename : string</span>
<span class="sd">            Name of the text file containing IERS Bulletin A parameters.</span>
<span class="sd">        columns : list of strings</span>
<span class="sd">            list of columns as they appear in the file.</span>
<span class="sd">            A KeyError is raise if the list does not contain</span>
<span class="sd">            each of [&#39;mjd&#39;, &#39;dut1&#39;, &#39;x&#39;, &#39;y&#39;].</span>

<span class="sd">        Any other keyword arguments are passed to the `numpy.loadtxt` function</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mjd : array_like</span>
<span class="sd">            Modified Julian date</span>
<span class="sd">        dut1 : array_like</span>
<span class="sd">            UT1-UTC time correction</span>
<span class="sd">        x : array_like</span>
<span class="sd">        y : array_like</span>
<span class="sd">            Polar motion corrections</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">req_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mjd&quot;</span><span class="p">,</span> <span class="s2">&quot;dut1&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">req_columns</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span><span class="n">columns</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                <span class="s2">&quot;Missing columns </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">req_columns</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">columns</span><span class="p">)))</span>
            <span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;unpack&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">mjd</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dut1</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">columns</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">req_columns</span><span class="p">)</span>
        <span class="n">mjd_min</span><span class="p">,</span> <span class="n">mjd_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mjd</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">mjd</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">qp</span><span class="o">.</span><span class="n">qp_set_iers_bulletin_a</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">mjd_min</span><span class="p">,</span> <span class="n">mjd_max</span><span class="p">,</span> <span class="n">dut1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Error loading Bulletin A data from file </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">mjd</span><span class="p">,</span> <span class="n">dut1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>


<div class="viewcode-block" id="QPoint.get_bulletin_a">
<a class="viewcode-back" href="../../api.html#qpoint.qpoint_class.QPoint.get_bulletin_a">[docs]</a>
    <span class="k">def</span> <span class="nf">get_bulletin_a</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mjd</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return dut1/x/y for given mjd. Numpy-vectorized.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">lib</span><span class="o">.</span><span class="n">qp_get_bulletin_a</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="n">fvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">fvec</span><span class="p">(</span><span class="n">mjd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">():</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">[()]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>
</div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">qpoint 1.12.4.post1.dev18+g486712d documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../qpoint.html" >qpoint</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">qpoint.qpoint_class</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2017-2024, Alexandra Rahlin.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.0.2.
    </div>
  </body>
</html>